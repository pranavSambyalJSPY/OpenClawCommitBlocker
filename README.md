# commit-blocker

`commit-blocker` is a Python CLI for detecting likely agent-generated pull requests based on commit/PR residue signals.

## Purpose

The project provides a practical baseline for:

- extracting residue-style signals from repository history and content (`signals.py`),
- combining those signals into a weighted risk score (`scorer.py`), and
- producing explainable output consumable by machines and humans (`report.py`).

## Project layout

- `src/commit_blocker/signals.py`: signal data model and heuristic extractors.
- `src/commit_blocker/scorer.py`: weighted score aggregation and risk-band mapping.
- `src/commit_blocker/report.py`: JSON + table rendering with contribution breakdown.
- `docs/signal-taxonomy.md`: baseline signal taxonomy and extension guidance.
- `config/default_weights.json`: default scoring weights.

## Detection logic (current baseline)

The scanner currently evaluates:

- **Agentic commit message phrases** (`generated by`, `as an ai`, etc.)
- **Templated commit message structure** (`Summary`, `Testing`, `Notes` sections)
- **Unusual commit-hour concentration** (00:00â€“05:59)
- **Commit burst behavior** (dense activity in 20-minute windows)
- **Generic/automation-like author identities** (`bot`, `ai`, `automation`, `noreply`)
- **Repository TODO placeholder density** (`TODO`, `FIXME`, `TBD`, `fill this in`)

## Quick start

```bash
python -m venv .venv
source .venv/bin/activate
pip install -e .
commit-blocker scan .
commit-blocker scan . --format json
```

## CLI

```bash
commit-blocker scan <repo_path> [--format table|json] [--max-commits 60] [--weights-file path/to/weights.json]
commit-blocker eval <examples.jsonl> [--config eval/config.json] [--output eval/report.json] [--weights-file path/to/weights.json]
```

If `config/default_weights.json` exists in the current working directory, the CLI uses it automatically.

## Output

Both output modes include:

- normalized score (`0.0-1.0`)
- score out of 100
- risk band (`low`, `medium`, `high`)
- per-signal contribution (`signal_score * weight`) with evidence


## Evaluation workflow

Use labeled examples to calibrate thresholds and guard against precision regressions:

```bash
commit-blocker eval eval/examples.jsonl --config eval/config.json --output eval/report.json
```

The eval workflow computes precision/recall/F1, confusion matrix, threshold sweep, and false-positive rate by repo type. It also enforces a precision regression budget and a launch gate target (`precision >= 0.9` at medium threshold). See `eval/README.md` for details.

## Notes

This remains heuristic and explainability-first. For production usage, calibrate thresholds against labeled examples to control false positives per repository type.
